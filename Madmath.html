<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mad Math - Math Quiz Generator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #000000;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .mad-title {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .mad-title h1 {
            color: #ff4757;
            font-size: 3.5rem;
            text-shadow: 3px 3px 0 #ffa502;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .mad-title p {
            color: #57606f;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 15px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        select, input, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        button {
            background-color: #ff4757;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background-color: #ff3742;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        #generate-btn {
            background-color: #2ed573;
        }

        #generate-btn:hover {
            background-color: #25c75a;
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.4);
        }

        .quiz-container {
            margin-top: 20px;
            transition: all 0.5s;
        }

        .question {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db;
            transition: all 0.3s;
        }

        .question.madness {
            border-left: 5px solid #8b00ff;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            box-shadow: 0 5px 15px rgba(139, 0, 255, 0.2);
        }

        .question:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .question-number {
            font-weight: 700;
            color: #3498db;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .question-number.madness {
            color: #8b00ff;
            text-shadow: 1px 1px 2px rgba(139, 0, 255, 0.3);
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 600px) {
            .options {
                grid-template-columns: 1fr;
            }
        }

        .option {
            padding: 15px;
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .option:hover {
            background-color: #f1f8ff;
            border-color: #3498db;
            transform: scale(1.03);
        }

        .option.selected {
            background-color: #d6eaf8;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .option.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .option.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 10px;
            display: none;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            display: block;
            animation: popIn 0.5s;
        }

        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
            animation: shake 0.5s;
        }

        .score-container {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeIn 1s;
        }

        .score {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 15px 0;
        }

        .score-message {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .hidden {
            display: none;
        }

        .timer {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: #ff4757;
            margin-bottom: 15px;
        }

        .math-symbols {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.05;
        }

        .math-symbol {
            position: absolute;
            font-size: 3rem;
            color: #ff4757;
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .bounce {
            animation: bounce 1s;
        }

        /* Difficulty indicators */
        .difficulty-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .easy { background-color: #2ed573; }
        .medium { background-color: #ffa502; }
        .hard { background-color: #ff4757; }
        .madness { 
            background: linear-gradient(45deg, #8b00ff, #ff1493);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(139, 0, 255, 0.7); }
            50% { box-shadow: 0 0 15px rgba(255, 20, 147, 0.7); }
            100% { box-shadow: 0 0 5px rgba(139, 0, 255, 0.7); }
        }

        .madness-warning {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="math-symbols" id="math-symbols"></div>
        
        <header class="mad-title">
            <h1>MAD MATH</h1>
            <p>Generate crazy math quizzes and test your skills!</p>
            <div class="timer" id="timer">Time: <span id="time">0</span>s</div>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="quiz-type">Quiz Type</label>
                <select id="quiz-type">
                    <option value="arithmetic">Arithmetic</option>
                    <option value="algebra">Basic Algebra</option>
                    <option value="advanced">Advanced Math</option>
                    <option value="mixed">Mixed Madness</option>
                </select>
            </div>

            <div class="control-group">
                <label for="difficulty">Difficulty</label>
                <select id="difficulty">
                    <option value="easy"><span class="difficulty-indicator easy"></span>Easy</option>
                    <option value="medium" selected><span class="difficulty-indicator medium"></span>Medium</option>
                    <option value="hard"><span class="difficulty-indicator hard"></span>Hard</option>
                    <option value="madness"><span class="difficulty-indicator madness"></span>MADNESS (Einstein Level!)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="question-count">Number of Questions</label>
                <input type="number" id="question-count" min="1" max="20" value="5">
            </div>
        </div>

        <div id="madness-warning" class="madness-warning" style="display: none;">
            ‚ö†Ô∏è WARNING: MADNESS MODE ACTIVATED! ‚ö†Ô∏è<br>
            You are about to enter the realm of mathematical insanity!<br>
            Only the greatest minds dare venture here...
        </div>

        <button id="generate-btn">Generate Mad Quiz!</button>

        <div class="quiz-container" id="quiz-container">
            <!-- Quiz questions will be generated here -->
        </div>

        <div class="score-container" id="score-container">
            <h2>Mad Math Results!</h2>
            <p class="score-message" id="score-message">You're a math wizard!</p>
            <p class="score">Score: <span id="score">0</span>/<span id="total">0</span></p>
            <p id="time-result">Time: <span id="final-time">0</span> seconds</p>
            <button id="reset-btn">Try Another Mad Quiz!</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const generateBtn = document.getElementById('generate-btn');
        const quizContainer = document.getElementById('quiz-container');
        const scoreContainer = document.getElementById('score-container');
        const scoreElement = document.getElementById('score');
        const totalElement = document.getElementById('total');
        const resetBtn = document.getElementById('reset-btn');
        const timerElement = document.getElementById('time');
        const finalTimeElement = document.getElementById('final-time');
        const scoreMessageElement = document.getElementById('score-message');
        const mathSymbolsContainer = document.getElementById('math-symbols');
        const madnessWarning = document.getElementById('madness-warning');
        const difficultySelect = document.getElementById('difficulty');

        // Quiz state
        let currentQuiz = [];
        let userAnswers = [];
        let quizCompleted = false;
        let startTime;
        let timerInterval;
        let usedQuestions = new Set(); // Track used questions to prevent repeats

        // Math symbols for background
        const mathSymbols = ['+', '-', '√ó', '√∑', '=', 'œÄ', '‚àö', 'x', 'y', 'z', '%', '‚àû', '‚à´', '‚àÇ', 'Œ£', 'Œî', 'Œ∏', 'Œ±', 'Œ≤', 'Œ≥'];

        // Show/hide madness warning
        difficultySelect.addEventListener('change', function() {
            if (this.value === 'madness') {
                madnessWarning.style.display = 'block';
            } else {
                madnessWarning.style.display = 'none';
            }
        });

        // Create floating math symbols
        function createMathSymbols() {
            mathSymbolsContainer.innerHTML = '';
            for (let i = 0; i < 15; i++) {
                const symbol = document.createElement('div');
                symbol.className = 'math-symbol';
                symbol.textContent = mathSymbols[Math.floor(Math.random() * mathSymbols.length)];
                symbol.style.left = `${Math.random() * 100}%`;
                symbol.style.top = `${Math.random() * 100}%`;
                symbol.style.fontSize = `${Math.random() * 2 + 2}rem`;
                symbol.style.transform = `rotate(${Math.random() * 360}deg)`;
                mathSymbolsContainer.appendChild(symbol);
            }
        }

        // Start the timer
        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(() => {
                const currentTime = new Date();
                const elapsed = Math.floor((currentTime - startTime) / 1000);
                timerElement.textContent = elapsed;
            }, 1000);
        }

        // Stop the timer
        function stopTimer() {
            clearInterval(timerInterval);
            const endTime = new Date();
            const totalTime = Math.floor((endTime - startTime) / 1000);
            finalTimeElement.textContent = totalTime;
            return totalTime;
        }

        // Event Listeners
        generateBtn.addEventListener('click', generateQuiz);
        resetBtn.addEventListener('click', resetQuiz);

        // Generate a new quiz
        function generateQuiz() {
            const quizType = document.getElementById('quiz-type').value;
            const difficulty = document.getElementById('difficulty').value;
            const questionCount = parseInt(document.getElementById('question-count').value);
            
            // Reset state
            currentQuiz = [];
            userAnswers = [];
            quizCompleted = false;
            usedQuestions.clear(); // Clear used questions for new quiz
            
            // Generate questions without repeats
            for (let i = 0; i < questionCount; i++) {
                let question;
                let attempts = 0;
                const maxAttempts = 50; // Prevent infinite loops
                
                do {
                    if (difficulty === 'madness') {
                        question = generateMadnessQuestion();
                    } else if (quizType === 'arithmetic') {
                        question = generateArithmeticQuestion(difficulty);
                    } else if (quizType === 'algebra') {
                        question = generateAlgebraQuestion(difficulty);
                    } else if (quizType === 'advanced') {
                        question = generateAdvancedQuestion(difficulty);
                    } else { // mixed
                        const questionTypes = ['arithmetic', 'algebra'];
                        if (difficulty === 'hard') questionTypes.push('advanced');
                        const randomType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                        
                        if (randomType === 'arithmetic') {
                            question = generateArithmeticQuestion(difficulty);
                        } else if (randomType === 'algebra') {
                            question = generateAlgebraQuestion(difficulty);
                        } else {
                            question = generateAdvancedQuestion(difficulty);
                        }
                    }
                    attempts++;
                } while (usedQuestions.has(question.question) && attempts < maxAttempts);
                
                // Add question to used set and current quiz
                usedQuestions.add(question.question);
                currentQuiz.push(question);
            }
            
            // Display quiz
            displayQuiz();
            
            // Start timer
            startTimer();
            
            // Hide score container
            scoreContainer.style.display = 'none';
        }

        // Generate MADNESS level questions (Einstein difficulty!)
        function generateMadnessQuestion() {
            const questionTypes = [
                'calculus_derivative',
                'calculus_integral',
                'complex_numbers',
                'advanced_algebra',
                'trigonometry_advanced',
                'number_theory',
                'sequences_series',
                'matrix_operations'
            ];
            
            const questionType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
            
            switch(questionType) {
                case 'calculus_derivative':
                    return generateCalculusDerivative();
                case 'calculus_integral':
                    return generateCalculusIntegral();
                case 'complex_numbers':
                    return generateComplexNumbers();
                case 'advanced_algebra':
                    return generateAdvancedAlgebra();
                case 'trigonometry_advanced':
                    return generateAdvancedTrigonometry();
                case 'number_theory':
                    return generateNumberTheory();
                case 'sequences_series':
                    return generateSequencesSeries();
                case 'matrix_operations':
                    return generateMatrixOperations();
                default:
                    return generateCalculusDerivative();
            }
        }

        // Generate calculus derivative question
        function generateCalculusDerivative() {
            const functions = [
                { expr: 'x¬≥ + 2x¬≤ - 5x + 3', derivative: '3x¬≤ + 4x - 5' },
                { expr: 'sin(x) + cos(x)', derivative: 'cos(x) - sin(x)' },
                { expr: 'e^x ¬∑ ln(x)', derivative: 'e^x ¬∑ ln(x) + e^x/x' },
                { expr: 'x¬≤ ¬∑ sin(x)', derivative: '2x¬∑sin(x) + x¬≤¬∑cos(x)' },
                { expr: '(x¬≤ + 1)/(x - 1)', derivative: '(x¬≤ - 2x - 1)/(x - 1)¬≤' },
                { expr: '4x¬≥ - 3x¬≤ + 2x - 1', derivative: '12x¬≤ - 6x + 2' },
                { expr: 'tan(x)', derivative: 'sec¬≤(x)' },
                { expr: 'e^(2x)', derivative: '2e^(2x)' },
                { expr: 'ln(x¬≤)', derivative: '2/x' },
                { expr: 'x‚Å¥ + x¬≥ - x', derivative: '4x¬≥ + 3x¬≤ - 1' },
                { expr: 'cos(x) - sin(x)', derivative: '-sin(x) - cos(x)' },
                { expr: '‚àöx', derivative: '1/(2‚àöx)' },
                { expr: 'x ¬∑ cos(x)', derivative: 'cos(x) - x¬∑sin(x)' },
                { expr: '1/x¬≤', derivative: '-2/x¬≥' },
                { expr: 'e^x + sin(x)', derivative: 'e^x + cos(x)' }
            ];
            
            const func = functions[Math.floor(Math.random() * functions.length)];
            const wrongOptions = [
                '2x + 4',
                'x¬≤ + 2x',
                'cos(x) + sin(x)',
                '3x¬≤ - 4x + 5'
            ];
            
            const options = [func.derivative, ...wrongOptions.slice(0, 3)];
            
            return {
                type: 'madness',
                question: `Find the derivative of f(x) = ${func.expr}`,
                correctAnswer: func.derivative,
                options: shuffleArray(options)
            };
        }

        // Generate calculus integral question
        function generateCalculusIntegral() {
            const integrals = [
                { expr: '2x + 3', integral: 'x¬≤ + 3x + C' },
                { expr: 'x¬≤ - 4x', integral: 'x¬≥/3 - 2x¬≤ + C' },
                { expr: 'sin(x)', integral: '-cos(x) + C' },
                { expr: 'e^x', integral: 'e^x + C' },
                { expr: '1/x', integral: 'ln|x| + C' },
                { expr: '3x¬≤ + 2x', integral: 'x¬≥ + x¬≤ + C' },
                { expr: 'cos(x)', integral: 'sin(x) + C' },
                { expr: '6x', integral: '3x¬≤ + C' },
                { expr: '4x¬≥', integral: 'x‚Å¥ + C' },
                { expr: '1/x¬≤', integral: '-1/x + C' },
                { expr: 'e^(3x)', integral: '(1/3)e^(3x) + C' },
                { expr: '5', integral: '5x + C' },
                { expr: 'x', integral: 'x¬≤/2 + C' },
                { expr: '2cos(x)', integral: '2sin(x) + C' },
                { expr: 'sec¬≤(x)', integral: 'tan(x) + C' }
            ];
            
            const integral = integrals[Math.floor(Math.random() * integrals.length)];
            const wrongOptions = [
                'x¬≥/2 + 3x¬≤',
                '2x¬≤ + 3x',
                'cos(x) + C',
                'x¬≤/2 - 4x'
            ];
            
            const options = [integral.integral, ...wrongOptions.slice(0, 3)];
            
            return {
                type: 'madness',
                question: `Evaluate ‚à´(${integral.expr}) dx`,
                correctAnswer: integral.integral,
                options: shuffleArray(options)
            };
        }

        // Generate complex numbers question
        function generateComplexNumbers() {
            const problems = [
                { expr: '(3 + 4i) + (2 - 3i)', answer: '5 + i' },
                { expr: '(2 + 3i) √ó (1 - 2i)', answer: '8 - i' },
                { expr: '|3 + 4i|', answer: '5' },
                { expr: '(1 + i)¬≤', answer: '2i' },
                { expr: 'i^4', answer: '1' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['3 + 2i', '4 - i', '2 + 3i'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Simplify: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate advanced algebra question
        function generateAdvancedAlgebra() {
            const problems = [
                { expr: 'x¬≤ - 5x + 6 = 0', answer: 'x = 2, 3' },
                { expr: '2^x = 8', answer: 'x = 3' },
                { expr: 'log‚ÇÇ(x) = 4', answer: 'x = 16' },
                { expr: 'x¬≥ - 8 = 0', answer: 'x = 2' },
                { expr: '‚àö(x + 5) = 3', answer: 'x = 4' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['x = 1, 2', 'x = 5', 'x = 8'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Solve: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate advanced trigonometry question
        function generateAdvancedTrigonometry() {
            const problems = [
                { expr: 'sin(œÄ/6)', answer: '1/2' },
                { expr: 'cos(2œÄ/3)', answer: '-1/2' },
                { expr: 'tan(œÄ/4)', answer: '1' },
                { expr: 'sin¬≤(x) + cos¬≤(x)', answer: '1' },
                { expr: 'sin(90¬∞)', answer: '1' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['‚àö3/2', '0', '‚àö2/2'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Evaluate: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate number theory question
        function generateNumberTheory() {
            const problems = [
                { expr: 'GCD(24, 36)', answer: '12' },
                { expr: 'LCM(4, 6)', answer: '12' },
                { expr: '7 mod 3', answer: '1' },
                { expr: '2^10', answer: '1024' },
                { expr: 'œÜ(10) (Euler\'s totient)', answer: '4' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['8', '6', '10'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Find: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate sequences and series question
        function generateSequencesSeries() {
            const problems = [
                { expr: 'Sum of 1 + 2 + 3 + ... + 10', answer: '55' },
                { expr: 'Fibonacci: 1,1,2,3,5,8,?', answer: '13' },
                { expr: 'Geometric series: 2 + 4 + 8 + 16 = ?', answer: '30' },
                { expr: 'Arithmetic: 3,7,11,15,? (next term)', answer: '19' },
                { expr: 'Sum of first 5 odd numbers', answer: '25' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['21', '17', '32'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Find: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate matrix operations question
        function generateMatrixOperations() {
            const problems = [
                { expr: 'det([[2,1],[3,4]])', answer: '5' },
                { expr: '[[1,2]] + [[3,4]]', answer: '[[4,6]]' },
                { expr: '[[2,0],[0,3]] √ó [[1,2],[3,1]]', answer: '[[2,4],[9,3]]' },
                { expr: 'Trace of [[1,2],[3,4]]', answer: '5' },
                { expr: 'Rank of [[1,2],[2,4]]', answer: '1' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            const wrongOptions = ['[[3,2]]', '8', '2'];
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'madness',
                question: `Calculate: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate advanced math question (for non-madness hard mode)
        function generateAdvancedQuestion(difficulty) {
            const problems = [
                { expr: 'x¬≤ + 4x + 4 = 0', answer: 'x = -2', type: 'quadratic' },
                { expr: '‚àö49', answer: '7', type: 'square_root' },
                { expr: '2¬≥ √ó 3¬≤', answer: '72', type: 'exponents' },
                { expr: 'log‚ÇÅ‚ÇÄ(100)', answer: '2', type: 'logarithm' }
            ];
            
            const problem = problems[Math.floor(Math.random() * problems.length)];
            let wrongOptions;
            
            if (problem.type === 'quadratic') {
                wrongOptions = ['x = -4', 'x = 2', 'x = 4'];
            } else if (problem.type === 'square_root') {
                wrongOptions = ['6', '8', '9'];
            } else if (problem.type === 'exponents') {
                wrongOptions = ['36', '18', '54'];
            } else {
                wrongOptions = ['1', '3', '10'];
            }
            
            const options = [problem.answer, ...wrongOptions];
            
            return {
                type: 'advanced',
                question: `Solve: ${problem.expr}`,
                correctAnswer: problem.answer,
                options: shuffleArray(options)
            };
        }

        // Generate arithmetic question
        function generateArithmeticQuestion(difficulty) {
            let num1, num2, operator, correctAnswer, options;
            
            // Determine range based on difficulty
            let range;
            if (difficulty === 'easy') range = 10;
            else if (difficulty === 'medium') range = 50;
            else range = 100;
            
            // Random operator
            const operators = ['+', '-', '√ó', '√∑'];
            operator = operators[Math.floor(Math.random() * operators.length)];
            
            // Generate numbers based on operator
            if (operator === '+') {
                num1 = Math.floor(Math.random() * range) + 1;
                num2 = Math.floor(Math.random() * range) + 1;
                correctAnswer = num1 + num2;
            } else if (operator === '-') {
                num1 = Math.floor(Math.random() * range) + 1;
                num2 = Math.floor(Math.random() * num1) + 1;
                correctAnswer = num1 - num2;
            } else if (operator === '√ó') {
                num1 = Math.floor(Math.random() * (range/10)) + 1;
                num2 = Math.floor(Math.random() * (range/10)) + 1;
                correctAnswer = num1 * num2;
            } else { // division
                num2 = Math.floor(Math.random() * (range/10)) + 1;
                correctAnswer = Math.floor(Math.random() * (range/10)) + 1;
                num1 = num2 * correctAnswer;
            }
            
            // Generate options
            options = generateOptions(correctAnswer, difficulty);
            
            return {
                type: 'arithmetic',
                question: `${num1} ${operator} ${num2} = ?`,
                correctAnswer: correctAnswer,
                options: options
            };
        }

        // Generate algebra question
        function generateAlgebraQuestion(difficulty) {
            let a, b, c, x, correctAnswer, options;
            
            // Determine range based on difficulty
            let range;
            if (difficulty === 'easy') range = 10;
            else if (difficulty === 'medium') range = 20;
            else range = 50;
            
            // Generate simple linear equation: ax + b = c
            a = Math.floor(Math.random() * range/5) + 1;
            x = Math.floor(Math.random() * range) + 1;
            b = Math.floor(Math.random() * range) + 1;
            c = a * x + b;
            
            correctAnswer = x;
            
            // Generate options
            options = generateOptions(correctAnswer, difficulty);
            
            return {
                type: 'algebra',
                question: `Solve for x: ${a}x + ${b} = ${c}`,
                correctAnswer: correctAnswer,
                options: options
            };
        }

        // Generate answer options
        function generateOptions(correctAnswer, difficulty) {
            const options = [correctAnswer];
            const optionCount = 4;
            
            // Determine deviation based on difficulty
            let deviation;
            if (difficulty === 'easy') deviation = 5;
            else if (difficulty === 'medium') deviation = 10;
            else deviation = 20;
            
            // Generate incorrect options
            while (options.length < optionCount) {
                let option;
                
                // Vary the deviation to create more realistic wrong answers
                const currentDeviation = Math.floor(Math.random() * deviation) + 1;
                
                // Sometimes add, sometimes subtract
                if (Math.random() > 0.5) {
                    option = correctAnswer + currentDeviation;
                } else {
                    option = correctAnswer - currentDeviation;
                }
                
                // Ensure option is positive and not already in the array
                if (option > 0 && !options.includes(option)) {
                    options.push(option);
                }
            }
            
            // Shuffle options
            return shuffleArray(options);
        }

        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Display the quiz
        function displayQuiz() {
            quizContainer.innerHTML = '';
            const difficulty = document.getElementById('difficulty').value;
            
            currentQuiz.forEach((question, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = `question ${difficulty === 'madness' ? 'madness' : ''}`;
                questionElement.innerHTML = `
                    <div class="question-number ${difficulty === 'madness' ? 'madness' : ''}">
                        Question ${index + 1} ${difficulty === 'madness' ? 'üß†‚ö°' : ''}
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">
                        ${question.options.map((option, optionIndex) => `
                            <div class="option" data-question="${index}" data-option="${optionIndex}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback-${index}"></div>
                `;
                
                quizContainer.appendChild(questionElement);
            });
            
            // Add event listeners to options
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Add submit button
            const submitButton = document.createElement('button');
            submitButton.textContent = difficulty === 'madness' ? 'Submit Einstein Quiz!' : 'Submit Mad Quiz!';
            submitButton.id = 'submit-btn';
            submitButton.addEventListener('click', submitQuiz);
            quizContainer.appendChild(submitButton);
        }

        // Handle option selection
        function selectOption(event) {
            if (quizCompleted) return;
            
            const questionIndex = parseInt(event.target.dataset.question);
            const optionIndex = parseInt(event.target.dataset.option);
            
            // Store user's answer
            userAnswers[questionIndex] = currentQuiz[questionIndex].options[optionIndex];
            
            // Update UI
            const questionElement = event.target.closest('.question');
            
            // Remove selected class from all options in this question
            questionElement.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            event.target.classList.add('selected');
            
            // Clear previous feedback
            const feedbackElement = document.getElementById(`feedback-${questionIndex}`);
            feedbackElement.className = 'feedback';
            feedbackElement.textContent = '';
        }

        // Submit the quiz
        function submitQuiz() {
            if (quizCompleted) return;
            
            let score = 0;
            const totalTime = stopTimer();
            const difficulty = document.getElementById('difficulty').value;
            
            // Check each answer
            currentQuiz.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;
                
                if (isCorrect) {
                    score++;
                }
                
                // Show feedback
                const feedbackElement = document.getElementById(`feedback-${index}`);
                if (isCorrect) {
                    feedbackElement.textContent = difficulty === 'madness' ? 'Genius! Einstein would be proud!' : 'Correct! You nailed it!';
                    feedbackElement.className = 'feedback correct';
                } else {
                    feedbackElement.textContent = `Incorrect. The correct answer is ${question.correctAnswer}.`;
                    feedbackElement.className = 'feedback incorrect';
                }
                
                // Highlight correct and incorrect answers
                const questionElement = document.querySelector(`.option[data-question="${index}"]`).closest('.question');
                questionElement.querySelectorAll('.option').forEach(option => {
                    const optionValue = currentQuiz[index].options[parseInt(option.dataset.option)];
                    option.classList.remove('correct', 'incorrect');
                    
                    if (optionValue === question.correctAnswer) {
                        option.classList.add('correct');
                    } else if (optionValue === userAnswer && !isCorrect) {
                        option.classList.add('incorrect');
                    }
                });
            });
            
            // Set score message based on performance and difficulty
            const percentage = (score / currentQuiz.length) * 100;
            let message;
            
            if (difficulty === 'madness') {
                if (percentage === 100) {
                    message = "üß†‚ö° INCREDIBLE! You've achieved Einstein-level genius status!";
                } else if (percentage >= 80) {
                    message = "üéì Outstanding! You're approaching theoretical physicist level!";
                } else if (percentage >= 60) {
                    message = "ü§î Good effort! Even Einstein had to think hard sometimes!";
                } else {
                    message = "üìö Don't worry! Mathematics is the language of the universe - keep studying!";
                }
            } else {
                if (percentage === 100) {
                    message = "Perfect! You're a math genius!";
                } else if (percentage >= 80) {
                    message = "Excellent! You really know your math!";
                } else if (percentage >= 60) {
                    message = "Good job! Keep practicing!";
                } else {
                    message = "Don't give up! Practice makes perfect!";
                }
            }
            
            scoreMessageElement.textContent = message;
            
            // Show score
            scoreElement.textContent = score;
            totalElement.textContent = currentQuiz.length;
            scoreContainer.style.display = 'block';
            
            quizCompleted = true;
        }

        // Reset the quiz
        function resetQuiz() {
            quizContainer.innerHTML = '';
            scoreContainer.style.display = 'none';
            timerElement.textContent = '0';
            madnessWarning.style.display = 'none';
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            createMathSymbols();
            generateQuiz();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAD STUDYS Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --accent: #0078d7;
      --win-bg: #f3f3f3;
      --win-sidebar: #fafafa;
      --win-border: #e0e0e0;
      --win-hover: #e5e5e5;
      --win-active: #d6d6d6;
      --text: #1a1a1a;
    }
    .dark {
      --accent: #60cdff;
      --win-bg: #202020;
      --win-sidebar: #1a1a1a;
      --win-border: #333;
      --win-hover: #2b2b2b;
      --win-active: #363636;
      --text: #fff;
    }
    body {
      margin: 0;
      background: var(--win-bg);
      color: var(--text);
      font-family: "Segoe UI", Roboto, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .title-bar {
      background: var(--win-sidebar);
      border-bottom: 1px solid var(--win-border);
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
      font-weight: 500;
      font-size: 13px;
      color: var(--text);
    }
    .title-bar span {
      color: var(--accent);
    }
    .toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--win-sidebar);
      border-bottom: 1px solid var(--win-border);
      padding: 6px 10px;
    }
    .tool-btn {
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.15s;
    }
    .tool-btn:hover { background: var(--win-hover); }
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .sidebar {
      width: 250px;
      background: var(--win-sidebar);
      border-right: 1px solid var(--win-border);
      padding: 8px;
      overflow-y: auto;
    }
    .side-item {
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.15s;
    }
    .side-item:hover { background: var(--win-hover); }
    .side-item.active { background: var(--win-active); font-weight: 500; }
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border-bottom: 1px solid var(--win-border);
      background: var(--win-sidebar);
      font-size: 13px;
      overflow-x: auto;
      white-space: nowrap;
    }
    .crumb {
      cursor: pointer;
      color: var(--accent);
    }
    .crumb:hover { text-decoration: underline; }
    .grid {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }
    .file {
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
      transition: background 0.15s;
      position: relative;
    }
    .file:hover { background: var(--win-hover); }
    .icon {
      width: 48px; height: 48px;
      margin: 0 auto 6px;
      border-radius: 4px;
      background: var(--accent);
      display: flex; align-items: center; justify-content: center;
      color: white;
    }
    .name { font-size: 12px; word-break: break-word; }
    .context-menu {
      position: absolute;
      background: var(--win-sidebar);
      border: 1px solid var(--win-border);
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      display: none;
      flex-direction: column;
      z-index: 9999;
      min-width: 160px;
      padding: 4px 0;
    }
    .menu-item {
      padding: 6px 16px;
      font-size: 13px;
      cursor: pointer;
    }
    .menu-item:hover { background: var(--win-hover); }
    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <div class="title-bar">
    <div><span>MAD STUDYS</span> Explorer</div>
    <div id="darkToggle" class="cursor-pointer">üåì</div>
  </div>
  <div class="toolbar">
    <div class="tool-btn" id="newFolderBtn">üìÅ New Folder</div>
    <div class="tool-btn" id="uploadBtn">‚¨ÜÔ∏è Upload</div>
  </div>
  <div class="main">
    <div class="sidebar" id="sidebar"></div>
    <div class="content">
      <div class="breadcrumb" id="breadcrumb"></div>
      <div class="grid" id="fileGrid"></div>
    </div>
  </div>

  <input type="file" id="fileInput" multiple accept=".html,.htm,.txt,.md,.json,.js,.css,.png,.jpg,.jpeg,.gif" />
  <div class="context-menu" id="contextMenu"></div>

  <script>
    const storageKey = "madstudys_explorer_data_v2";
    let fs = JSON.parse(localStorage.getItem(storageKey) || '{"root":{}}');
    let currentPath = ["root"];
    let dark = window.matchMedia("(prefers-color-scheme: dark)").matches;

    const sidebar = document.getElementById("sidebar");
    const breadcrumb = document.getElementById("breadcrumb");
    const grid = document.getElementById("fileGrid");
    const fileInput = document.getElementById("fileInput");
    const contextMenu = document.getElementById("contextMenu");

    if (dark) document.documentElement.classList.add("dark");

    document.getElementById("darkToggle").onclick = () => {
      dark = !dark;
      document.documentElement.classList.toggle("dark", dark);
    };
    // =============================
    // Utility functions
    // =============================
    function saveFS() {
      localStorage.setItem(storageKey, JSON.stringify(fs));
    }

    function getCurrentDir() {
      return currentPath.reduce((dir, key) => dir[key], fs);
    }

    function renderSidebar() {
      sidebar.innerHTML = "";
      const home = document.createElement("div");
      home.textContent = "Home";
      home.className = "side-item active";
      home.onclick = () => {
        currentPath = ["root"];
        renderAll();
      };
      sidebar.appendChild(home);
    }

    function renderBreadcrumb() {
      breadcrumb.innerHTML = "";
      currentPath.forEach((part, i) => {
        const crumb = document.createElement("span");
        crumb.className = "crumb";
        crumb.textContent = part === "root" ? "Home" : part;
        crumb.onclick = () => {
          currentPath = currentPath.slice(0, i + 1);
          renderAll();
        };
        breadcrumb.appendChild(crumb);
        if (i < currentPath.length - 1) {
          const sep = document.createElement("span");
          sep.textContent = "‚Ä∫";
          breadcrumb.appendChild(sep);
        }
      });
    }

    function renderGrid() {
      const dir = getCurrentDir();
      grid.innerHTML = "";
      const keys = Object.keys(dir);
      if (keys.length === 0) {
        const empty = document.createElement("div");
        empty.className = "text-center opacity-60 col-span-full mt-10";
        empty.innerHTML = "<p>No items</p>";
        grid.appendChild(empty);
        return;
      }

      keys.forEach((name) => {
        const item = dir[name];
        const el = document.createElement("div");
        el.className = "file";
        el.innerHTML = `
          <div class="icon">${item.type === "folder" ? "üìÅ" : "üìÑ"}</div>
          <div class="name">${name}</div>
        `;
        el.onclick = (e) => {
          if (item.type === "folder") {
            currentPath.push(name);
            renderAll();
          } else {
            const blob = new Blob([item.content], { type: item.mime || "text/plain" });
            const url = URL.createObjectURL(blob);
            window.open(url, "_blank");
          }
        };
        el.oncontextmenu = (e) => {
          e.preventDefault();
          openContextMenu(e.pageX, e.pageY, name, item);
        };
        grid.appendChild(el);
      });
    }

    function renderAll() {
      renderSidebar();
      renderBreadcrumb();
      renderGrid();
      saveFS();
    }

    // =============================
    // Context menu
    // =============================
    function openContextMenu(x, y, name, item) {
      contextMenu.style.display = "flex";
      contextMenu.style.left = `${x}px`;
      contextMenu.style.top = `${y}px`;
      contextMenu.innerHTML = "";

      const makeItem = (label, action) => {
        const el = document.createElement("div");
        el.className = "menu-item";
        el.textContent = label;
        el.onclick = () => {
          action();
          contextMenu.style.display = "none";
        };
        contextMenu.appendChild(el);
      };

      if (item.type === "folder") {
        makeItem("üóÇ Open", () => {
          currentPath.push(name);
          renderAll();
        });
      } else {
        makeItem("üóÇ Open in New Tab", () => {
          const blob = new Blob([item.content], { type: item.mime });
          const url = URL.createObjectURL(blob);
          window.open(url, "_blank");
        });
      }

      makeItem("‚úèÔ∏è Rename", () => renameItem(name));
      makeItem("üóë Delete", () => deleteItem(name));
    }

    window.addEventListener("click", (e) => {
      if (!contextMenu.contains(e.target)) contextMenu.style.display = "none";
    });

    // =============================
    // Actions
    // =============================
    document.getElementById("uploadBtn").onclick = () => fileInput.click();

    fileInput.onchange = (e) => {
      const dir = getCurrentDir();
      Array.from(e.target.files).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          dir[file.name] = {
            type: "file",
            content: ev.target.result,
            mime: file.type || "text/plain",
          };
          saveFS();
          renderGrid();
        };
        reader.readAsText(file);
      });
      e.target.value = "";
    };

    document.getElementById("newFolderBtn").onclick = () => {
      const name = prompt("Folder name:");
      if (!name) return;
      const dir = getCurrentDir();
      if (dir[name]) return alert("Folder already exists.");
      dir[name] = { type: "folder" };
      renderGrid();
      saveFS();
    };

    function renameItem(name) {
      const dir = getCurrentDir();
      const newName = prompt("Rename to:", name);
      if (!newName || newName === name) return;
      if (dir[newName]) return alert("Name already exists.");
      dir[newName] = dir[name];
      delete dir[name];
      renderGrid();
      saveFS();
    }

    function deleteItem(name) {
      const dir = getCurrentDir();
      if (confirm(`Delete "${name}"?`)) {
        delete dir[name];
        renderGrid();
        saveFS();
      }
    }

    renderAll();
  </script>
</body>
</html>
